# 生成函数
_原稿：数学/讲义/生成函数讲稿.md | 2021/12/19 | 吕欣老师_

生成函数（在数学上叫母函数）是解决组合问题和数列问题的强大武器。其实高中数学所用的特征根等方法已是生成函数，但不是完全意义上的生成函数。真正的生成函数极为复杂，并且要求有强大的数学运算能力和夯实的多项式基础。

##### 常见的等式结论
1. **$\sum x^i =  \frac 1 {1-x}$**
    > 由 $\sum_{i=0}^n = \frac {1-x^n} {1-x}$ 得, $\lim_{n \to +\infty}$ 时， $\sum_{i=0}^{n} x^i = \frac 1 {1-x}$。

2. **$\sum_{i=1}^{+\infty} \frac {x^i} i = -ln(1-x)$**
    > 令 $f(x) = \sum_{i=1}^{+\infty} \frac {x^i} i$，那么 $f'(x) = \sum_{i=0}^{+\infty} x^i$。 由 (1) 知， $f'(x) = \frac 1 {1-x}$。于是 $f(x) = \int f'(x) = -ln(1-x)$   。



### 普通生成函数

假设一个数列 $\{f\}$，那么这个数列可以与一个多项式函数 $F(x)=\sum f_i x^i$ 相对应。这个 $F(x)$ 定义为 $\{f\}$ 的生成函数。  
若 $\{f_i\}$ 代表规模为 $i$ 的组合问题，$F(x)$ 为 $\{f_i\}$ 的生成函数，那么 $F(x)$ 的一些运算是有组合意义的：   
$F(x)+G(x) = \sum (f_i + g_i) x^i$ ：$i$ 个元素组成 $f$ 结构**或**组成 $g$ 结构的方案数  
$F(x)G(x) = \sum_i ( \sum_{j+k=i} f_kg_j ) x^i$ : $i$ 个元素组成一个 $f$ **和** 一个 $g$ 结构的方案数  

##### 生成序列
假设我们要计算组成 $g$-结构的方案数，每个 $g$-结构由若干个 $f$-结构**有序**组成，那么:
$$ G(x) = \sum_{i=0}^{+\infty} F^k(x) = \frac 1 {1 - F(x)} $$
需要注意的是，这里要求有 $f_0 = 0$， 否则一个 $g$-结构有无限种方案。

##### 生成集合
现在要计算组成 $g$-结构的方案数，每个 $g$-结构由若干个 $f$-结构**无序**组成。这里仍然要求 $f_0=0$，否则任意大小 $g$-结构仍然会具有无穷种方案。  
首先有一种错误的做法，直接 $\frac {F(x)^k} {k!}$ 就得到了包含 $k$ 个 $f$-结构的方案数。但其实这是一种错误的解法，会导致答案偏小。比如一种情况 $2,2,4$ 会在生成排列时被计算 $3$ 次， 而不是 $3!=6$ 次。  
正确的推导应该是枚举每个规模的 $f$-结构在目标的 $g$-结构中出现了多少次。具体的，若有一个规模为 $i$ 的 $f$-结构，那么它在 $g$-结构中的出现次数可以用以下临时生成函数表示：
$$ H_i(x)  =  (x^0 + x^i + x^{2i} + \cdots ) ^ {f_i}  =  (\frac 1 {1-x^i}) ^ {f_i}$$  
并且 $g$-结构可以选择任意规模的 $f$-结构组成，于是:
$$ G(x) = \prod_{i=0} H_i(x) = \prod_{i=0} (\frac 1 {1-x^i}) ^ {f_i}$$  
然后可以对 $G(x)$ 使用 ln-then-exp 技巧：
$$ \begin{aligned}
\ln(G(x)) &= \sum_{i=0} f_i （ - \ln( 1-x^i ) ） \\
         &= \sum_{i=0} f_i \sum_{j=0} \frac {x^{ij}} j \\
         &= \sum_{i=0} \frac 1 j \sum_{i=0} f_i x^{ij} \\
         &= \sum_{i=0} \frac 1 j F(x^j) \\
\therefore G(x) &= e^{\sum_{i=0} \frac 1 j F(x^j)} \\
\end {aligned} $$
